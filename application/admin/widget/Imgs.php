<?php
/**
 * Desc  ï¼šImgs.php      å›¾ç‰‡åº“è°ƒç”¨
 * Author: Cool-Team ğŸ˜
 * Since ï¼šV1.0
 * Date  : 2019/4/10
 */

namespace app\admin\widget;


use app\common\model\SystemConfig;
use think\Controller;
use think\facade\Config;
use think\facade\Request;

class Imgs extends Controller
{
    //ä¸ƒç‰›äº‘å­˜å‚¨ç©ºé—´é…ç½®åŸŸå
    private $domain;

    //åˆå§‹åŒ–
    public function initialize()
    {
        parent::initialize(); // TODO: Change the autogenerated stub
        $qiNiuStatus = SystemConfig::whereValue( [ 'key' => 'qiNiuStatus' ], 'value' );
        if( $qiNiuStatus ){
            $this->domain = Config::get( 'qiNiuConfig.domain' );
        }else{
            $this->domain = Request::domain().'/';
        }
    }

    /**
     * å±•ç¤º
     * @example {:widget('module/Imgs/html', [ $data, $type, $name ] )}
     * @param null $data    å›¾ç‰‡æ•°æ®ï¼Œä¸€èˆ¬åœ¨ç¼–è¾‘æ—¶ä½¿ç”¨
     * @param null $type    æ•°æ®ç±»å‹ï¼Œ1ï¼šå¤šå›¾ï¼Œé»˜è®¤å•å›¾
     * @param null $name    å›¾ç‰‡inputæ¡†nameåï¼Œç”¨äºè¡¨å•æäº¤  å½“typeä¸º1æ—¶ï¼Œé»˜è®¤å€¼ä¸º imgs[]ï¼Œå¦åˆ™é»˜è®¤å€¼ä¸º img
     */
    public function html( $data = null, $type = null, $name = null )
    {
        switch ( (int)$type )
        {
            case 1:
                    $name = $name ?: 'imgs[]';
                    $html = $this->imgs( $data, $name );
                break;
            default:
                    $name = $name ?: 'img';
                    $html = $this->img( $data, $name );
                break;
        }
        echo $html;
    }

    /**
     * å•å›¾
     * @param string $data å›¾ç‰‡æ•°æ®
     * @param string $name inputæäº¤æ¡†nameå
     * @return string
     */
    private function img( $data, $name )
    {
        $html = '<div class="ctImgBox">';
        if( $data ){
            $html .= '<div class="ctImgBoxDiv" style="display: block">';
        }else{
            $html .= '<div class="ctImgBoxDiv">';
        }

        $html .= '      <img class="ctUploadImgShow" src="'. $this->domain.$data .'?imageView2/0/w/80/interlace/1/q/100" alt="">
                    </div>
                    <span class="ctUploadImg ctUploadImg-'.$name.'" >
                        <i class="glyphicon glyphicon-cloud-upload"></i>
                    </span>
                    <input type="hidden" class="ctImgVal" value="'. $data .'" name="'.$name.'" id="ctImgVal" >
                </div>';
        return $html;
    }

    /**
     * å¤šå›¾
     * @param mixed  $data   å›¾ç‰‡æ•°æ®
     * @param string $name   inputæäº¤æ¡†nameå
     * @return string
     */
    private function imgs( $data, $name )
    {
        $html = '<div class="ctImgBoxs">
                    <div class="imgs">';
            if( $data ){
                if( !is_array( $data ) ) $data = explode( ',', $data );
                $length = count( $data );
                if (count($data) == count($data, 1)) {
                    for ( $i=0; $i<$length; $i++ ){
                        $html .= '<div class="li">';

                                        if( strpos( $data[$i], 'mp3' ) || strpos( $data[$i], 'mp4' ) || strpos( $data[$i], 'ogg' ) || strpos( $data[$i], 'wav' ) ){
                                            $html .= '<video src="'.$this->domain.$data[$i].'"></video>';
                                        }else{
                                            $html .= '<img src="'.$this->domain.$data[$i].'?imageView2/0/w/80/interlace/1/q/80" alt="">';
                                        }

                                        $html .= '<span>æ›´æ¢</span>
                                        <input type="hidden" name="'.$name.'" value="'.$data[$i].'">
                                        <div class="ctImgBoxs-del-imgs">Ã—</div>
                                    </div>';
                    }
                } else {
                    for ( $i=0; $i<$length; $i++ ){
                        $html .= '<div class="li">';

                                        if( strpos( $data[$i]['img'], 'mp3' ) || strpos( $data[$i]['img'], 'mp4' ) || strpos( $data[$i]['img'], 'ogg' ) || strpos( $data[$i]['img'], 'wav' ) ){
                                            $html .= '<video src="'.$this->domain.$data[$i]['img'].'?imageView2/0/w/80/interlace/1/q/80"></video>';
                                        }else{
                                            $html .= '<img src="'.$this->domain.$data[$i]['img'].'?imageView2/0/w/80/interlace/1/q/80" alt="">';
                                        }

                                        $html .= '<span>æ›´æ¢</span>
                                        <input type="hidden" name="'.$name.'" value="'.$data[$i]['img'].'">
                                         <div class="ctImgBoxs-del-imgs">Ã—</div>
                                    </div>';
                    }
                }
            }
            $html.= '</div>
                    <div class="ctUploadImgs" data-name="'.$name.'">
                        <i class="glyphicon glyphicon-plus"></i>
                    </div>
                 </div>';
        return $html;
    }
}